---
title: "Course notes: Infectious Disease Modelling (Imperial College London via Coursera)"
date: 2023-04-11
permalink: /posts/2023-04-11/idm-notes
categories:
  - Course notes
tags:
  - Infectious Disease Modelling
toc: true
last_modified_at: 2023-04-14
---

This post records the notes when I learnt the [Infectious Disease Modelling (IDM)](https://www.coursera.org/specializations/infectious-disease-modelling#courses) by Nimalan Arinaminpathy. 

  <img src="/files/2023-04-11-IDM/2880px-Diagram_of_SIR_epidemic_model_states_and_transition_rates.svg.png" width="500"/>


## Developing the SIR Model
### Backgrounds
#### Solving differential equations using ode() in R
  <img src="/files/2023-04-11-IDM/Screenshot%202023-04-11%20at%2016.47.16.webp" width="500"/>

- For a quick introduction to exponential and logistic equations for population growth, visit: https://www.nature.com/scitable/knowledge/library/how-populations-grow-the-exponential-and-logistic-13240157
- For more detailed references on the deSolve package, try searching for deSolve vignettes https://cran.r-project.org/web/packages/deSolve/vignettes/deSolve.pdf

#### Competing Hazards in Compartmental Models
Basically $\frac{a}{a+b+c}$:
  <img src="/files/2023-04-11-IDM/Screenshot%202023-04-11%20at%2016.51.39.webp" width="500"/>

#### SIR Model with a Constant Force of Infection
$\lambda$: force of infection

```r
# LOAD THE PACKAGES:

library(deSolve)
library(reshape2)
library(ggplot2)

# MODEL INPUTS:

initial_state_values <- c(S = 10^6-1, I = 1, R = 0)

parameters <- c(lambda=0.2,
                gamma = 0.1)          


# TIMESTEPS:

times <- seq(from = 0, to = 60, by = 1) 

# SIR MODEL FUNCTION 
# We are renaming this to sir_model. 
# Remember to include the input arguments, 
# differential equations and output objects here.

sir_model <- function(time, state, parameters) {  

    with(as.list(c(state, parameters)), {  
        
    # The differential equations
      dS <- - lambda * S
      dI <- -gamma * I + lambda * S
      dR <- gamma * I            
      
    return(list(c(dS, dI, dR))) 
    })
  
}

# MODEL OUTPUT (solving the differential equations):

output <- as.data.frame(ode(y = initial_state_values, 
                            times = times, 
                            func = sir_model,
                            parms = parameters))

# Plot:

output_long <- melt(as.data.frame(output), id = "time")     

ggplot(data = output_long,   # specify object containing data to plot
       aes(x = time, 
           y = value, 
           colour = variable, 
           group = variable)) +       # assign columns to axes and groups
  geom_line() +                       # represent data as lines
  xlab("Time (days)")+                # add label for x axis
  ylab("Number of people") +          # add label for y axis
  labs(colour = "Compartment")        # add legend title
```

#### SIR Model with a Dynamic Force of Infection
  <img src="/files/2023-04-11-IDM/Screenshot%202023-04-14%20at%2011.55.02.webp" width="500"/>

$\lambda = \beta\frac{I}{N}$
$\beta$ is the infection rate, which may be represented as $p \times c$, where $p$ is the chance of getting infection per contact, and $c$ is the number of contacts made per day.

There is a [good post](https://parasiteecology.wordpress.com/2013/10/17/density-dependent-vs-frequency-dependent-disease-transmission/) on difference between Density-dependent and Frequency-dependent Disease Transmission ($\beta\frac{I}{N}$ and $\beta{I}$). 


  <img src="/files/2023-04-11-IDM/Screenshot%202023-04-15%20at%203.49.21%20PM.webp" width="500"/>

```r
# LOAD THE PACKAGES:

library(deSolve)
library(reshape2)
library(ggplot2)

# MODEL INPUTS:

initial_state_values <- c(S = 10^6-1, I = 1, R = 0)

parameters <- c(beta=1,
                gamma = 0.1)          


# TIMESTEPS:

times <- seq(from = 0, to = 60, by = 1) 

# SIR MODEL FUNCTION 
# We are renaming this to sir_model. 
# Remember to include the input arguments, 
# differential equations and output objects here.

sir_model <- function(time, state, parameters) {  

    with(as.list(c(state, parameters)), {
      N <- S+I+R
      lambda <- beta * (I/(N))
    # The differential equations
      dS <- -lambda * S
      dI <- -gamma * I + lambda * S
      dR <- gamma * I            
      
    return(list(c(dS, dI, dR))) 
    })
  
}

# MODEL OUTPUT (solving the differential equations):

output <- as.data.frame(ode(y = initial_state_values, 
                            times = times, 
                            func = sir_model,
                            parms = parameters))

# Plot:

output_long <- melt(as.data.frame(output), id = "time")     

ggplot(data = output_long,   # specify object containing data to plot
       aes(x = time, 
           y = value, 
           colour = variable, 
           group = variable)) +       # assign columns to axes and groups
  geom_line() +                       # represent data as lines
  xlab("Time (days)")+                # add label for x axis
  ylab("Number of people") +          # add label for y axis
  labs(colour = "Compartment")        # add legend title
```

#### $R_0$ and $R_{eff}$
$R_0=\frac{\beta}{\gamma}$
$R_{eff} = R_0\frac{S}{N}$

<img src="/files/2023-04-11-IDM/Screenshot%202023-04-15%20at%204.32.27%20PM.webp" width="500"/>
<img src="/files/2023-04-11-IDM/Screenshot%202023-04-15%20at%204.32.34%20PM.webp" width="500"/>
<img src="/files/2023-04-11-IDM/Screenshot%202023-04-15%20at%204.31.57%20PM.webp" width="500"/>
<img src="/files/2023-04-11-IDM/Screenshot%202023-04-15%20at%204.32.15%20PM.webp" width="500"/>

### Modifiers of Population Susceptibility

#### Modeling population turnover

<img src="/files/2023-04-11-IDM/Screenshot%202023-04-15%20at%204.34.49%20PM.webp" width="500"/>

$$
\lambda=\beta{\frac{I}{N}} \\
\frac{dS}{dt}=b(S+I+R)-\mu{S}-\lambda{S}\\
\frac{dI}{dt}=\lambda{S}-\mu{I}-\gamma{I}\\
\frac{dR}{dt}=\gamma{I}-\mu{R}
$$

#### A simple model for vaccination
In this simple model, $p$ of the population is immunized.

<img src="/files/2023-04-11-IDM/Screenshot%202023-04-16%20at%203.15.12%20PM.webp" width="500"/>

The critical vaccination threshold $p_c$ would be:

<img src="/files/2023-04-11-IDM/Screenshot%202023-04-16%20at%204.29.42%20PM.webp" width="500"/>

#### Modelling wanning immunity

<img src="/files/2023-04-11-IDM/Screenshot%202023-04-16%20at%204.32.21%20PM.webp" width="500"/>

## Interventions and Calibration
### Treatment and Vaccination
#### Modelling treatment

<img src="/files/2023-04-11-IDM/Screenshot%202023-04-17%20at%2016.07.59.webp" width="500"/>

#### Modelling leaky vaccination
$R_eff=(1-p)\times R_0 + p \times c_s\times R_0$
<img src="/files/2023-04-11-IDM/Screenshot%202023-04-18%20at%2018.32.55.webp" width="500"/>


```r
# LOAD THE PACKAGES:
library(deSolve)
library(reshape2)
library(ggplot2)

# MODEL INPUTS:

# Specify the total population size
N <- 1000000

# Specify the vaccination coverage
p <- 0.6

# Initial number of people in each compartment
initial_state_values <- c(S = (1-p)*N,    # the unvaccinated proportion of
                                          # the population is susceptible
                          I = 1,          # the epidemic starts with a
                                          # single infected person
                          R = 0,          # there is no prior immunity
                          V = p*N)        # a proportion p of the population
                                          # is vaccinated (vaccination coverage) 

# Parameters
parameters <- c(beta = 0.25,      # the infection rate in units of days^-1
                gamma = 0.1,      # the rate of recovery in units of days^-1
                c_s = 0.3)        # the reduction in the force of infection
                                  # acting on those vaccinated
                                  # note that c_s is a multiplicative term
                                  # and not a rate

# TIMESTEPS:

# Sequence of timesteps to solve the model at
times <- seq(from = 0, to = 730, by = 1)  # from 0 to 2 years, daily intervals

# MODEL FUNCTION: 

vaccine_model <- function(time, state, parameters) {  

    with(as.list(c(state, parameters)), {    
        
    # Defining lambda as a function of beta and I:
      lambda <- beta * I/N
        
    # The differential equations
      dS <- -lambda * S            
      dI <- lambda * S - gamma * I + c_s * lambda * V  # vaccinated people (V) can
                                                       # now also move into the I compartment
      dR <- gamma * I
      dV <- - c_s * lambda * V                         # vaccinated people become infected
                                                       # at a rate c_s * lambda                   
      
    # Return the number of people in each compartment at each timestep 
    # (in the same order as the input state variables)
    return(list(c(dS, dI, dR, dV))) 
    })
  
}

# MODEL OUTPUT:

# Solving the differential equations using the ode integration algorithm
output <- as.data.frame(ode(y = initial_state_values, 
                            times = times, 
                            func = vaccine_model,
                            parms = parameters))

# PLOT THE OUTPUT

# turn output dataset into long format
output_long <- melt(as.data.frame(output), id = "time")

# Adding a column for the prevalence proportion to the long-format output
output_long$prevalence <- output_long$value/sum(initial_state_values)

# Plot the number in each compartment over time
ggplot(data = output_long,                                               
       aes(x = time, y = prevalence, colour = variable, group = variable)) +  
  geom_line() +                                                          
  xlab("Time (days)")+                                                   
  ylab("Proportion of the population") +
  labs(title = paste("Leaky vaccine with coverage of", p*100, "%"), 
       colour = "Compartment") +
  scale_colour_brewer(palette = "Set2")

```


## Building on the SIR Model



