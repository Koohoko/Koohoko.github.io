---
title: "Course notes: Simulation-based Inference for Epidemiological Dynamics (Aaron A. King)"
date: 2023-05-25
permalink: /posts/2023-05-25/pomp-notes
categories:
  - Course notes
tags:
  - Infectious Disease Modelling
toc: true
last_modified_at: 2023-05-26
---

This post records the notes when I learnt the [Simulation-based Inference for Epidemiological Dynamics](https://kingaa.github.io/sbied/) by Aaron A. King, Edward L. Ionides, Jesse Wheeler. 

I learn this for better understanding of the details of IDM, and more practically, how to implement IDM using a Bayesian framework using R.

> A world is just a single realization of a stochastic process.

Some useful links here:
- [ ] [Simulation-based Inference for Epidemiological Dynamics](https://kingaa.github.io/sbied/)
- [ ] [Model-based Inference in Ecology and Epidemiology](https://kingaa.github.io/short-course/)
- [ ] [Implementing a POMP model from scratch](https://kingaa.github.io/sbied/intro/ricker.html)
- [ ] [Getting started with pomp](https://kingaa.github.io/pomp/vignettes/getting_started.html)
- [ ] [pomp: statistical inference for partially-observed Markov processes](https://kingaa.github.io/pomp/docs.html)
- [ ] [Two views of the pomp project](https://www.youtube.com/playlist?list=PLluGwj6FGt2SufYmENYAngy8dEMtfFEU8)
- [ ] [Partially observed Markov processes with spatial structure via the R package spatPomp](https://arxiv.org/abs/2101.01157)


---

## 0. Installing POMP
https://kingaa.github.io/sbied/prep/index.html

## [1: Introduction to Simulation-based Inference for Epidemiological Dynamics](https://kingaa.github.io/sbied/intro/index.html)
### What makes epidemiological inference hard? 
#### Epidemiological and Ecological Dynamics
Ecological systems are complex, open, nonlinear and nonstationary. It is useful to model them as stochastic models. For any observable phenomenon, multiple competing explanations are possible. Time series are particularly useful sources of data.
#### Obstacles to inference
Obstacles for ecological modeling and inference via nonlinear mechanistic models enumerated by Bjørnstad and Grenfell (2001)
1. Combining measurement noise and process noise.
2. Including covariates in mechanistically plausible ways.
3. Using continuous-time models.
4. Modeling and estimating interactions in coupled systems. 
5. Dealing with unobserved variables.
6. Modeling spatial-temporal dynamics.

#### Others
- How does one use incidence and mobility data to infer key epidemiological parameters? ([Andrade and Duggan, 2022](https://doi.org/10.1371/journal.pcbi.1010206))

### Partially observed Markov processes model
Also called hidden Markov model or state space model.
#### Mathematical definition
- Data $y^*_1,...,y^*_N$ collected at times $t_1<...<t_N$ are modeled as noisy, incomplete, and indirect *observations of a Markov process* $\{X(t), t ≥ t_0\}$.
- $\{X(t)\}$ is Markov if the history of the process, $\{X(s), s ≤ t\}$, is uninformative about the future of the process, $\{X(s), s ≥ t\}$, given the current value of the process, $X(t)$.
- In other words, Markov property holds if everything important for the dynamics of the system at $X_t$, we don't need to remember anything in the history to talk about the future process. 
- An important special case: any system of differential equations $dx/dt = f(x)$ is Markovian.

> A model is a data generating process: data are the realization of some stochastic process, and a model is to describe the stochastic process. 

#### Notation for POMP models
- Write $X_n = X(t_n)$ and $X_{0:N} = (X_0, ... , X_N)$. Let $Y_n$ be a random variable modeling the observation at time $t_n$.
- The one-step transition density, $f_{X_n \vert X_{n−1}}(x_n\vert x_{n−1};θ)$, together with the measurement density, $f_{Y_n \vert X_n} (y_n \vert x_n; θ)$ and the initial density, $f_{X_0} (x_0; θ)$, specify the entire POMP model.
- The joint density $f_{X_{0:N} ,Y_{1:N}} (x_{0:N}, y_{1:N}; θ)$ can be written as $$ f_{X_0}(x_0;θ) \prod_{n=1}^{N} f_{X_n \vert X_{n−1}}(x_n \vert x_{n−1};θ)f_{Y_n \vert X_n}(y_n \vert x_n;θ)$$

- The marginal density for $Y_{1:N}$ evaluated at the data, $y^∗_{1:N}$, is
$$f_{Y_{1:N}}(y_{1:N}^* \vert \theta)= \int f_{X_{0:N} ,Y_{1:N}} (x_{0:N}, y_{1:N}^*; θ) dx_{0:N}$$

#### POMP model schematic
  <img src="/files/2023-05-25-pomp/Screenshot%202023-05-27%20at%205.41.40%20PM.webp" width="500"/>
  
- The state process, $X_n$, is Markovian, i.e.,
$f_{X_n \vert X_{0:n−1} ,Y_{1:n−1}} (x_n \vert x_{0:n−1} , y_{1:n−1}) = f_{X_n \vert X_{n−1}} (x_n  \vert x_{n−1})$.
- Moreover, $Y_n$, depends only on the state at that time: $f_{Y_n \vert X_{0:N},Y_{1:n−1}}(y_n \vert x_{0:n},y_{1:n−1}) = f_{Y_n \vert X_n}(y_n \vert x_n)$, for $n = 1,...,N$.

#### What is a simulation-based method?
- Simulating random processes is often much easier than evaluating their transition probabilities.
- In other words, we may be able to write rprocess but not dprocess.
- **Simulation-based** methods require the user to specify rprocess but not dprocess.
- **Plug-and-play**, **likelihood-free** and **equation-free** are alternative terms for “simulation-based” methods.
- Much development of simulation-based statistical methodology has occurred in the past decade.

### The pomp package
It is useful to divide the pomp package functionality into different levels:
- *Basic model components*
  - `rinit`: simulator for the initial-state distribution, i.e., the distribution of the latent state at time $t_0$.
  - `rprocess` and `dprocess`: simulator and density evaluation procedure, respectively, for the process model.
  - `rmeasure` and `dmeasure`: simulator and density evaluation procedure, respectively, for the measurement model.
  - `rprior` and `dprior`: simulator and density evaluation procedure, respectively, for the prior distribution.
  - `skeleton`: evaluation of a deterministic skeleton.
  - `partrans`: parameter transformations.
- *Workhorses*
  Workhorses are R functions, built into the package, that cause the basic model component procedures to be executed.
- *Elementary POMP algorithms*
  These are algorithms that interrogate the model or the model/data confrontation without attempting to estimate parameters. There are currently four of these:
  - `simulate` performs simulations of the POMP model, i.e., it samples from the joint distribution of latent states and observables.
  - `pfilter` runs a sequential Monte Carlo (particle filter) algorithm to compute the likelihood and (optionally) estimate the prediction and filtering distributions of the latent state process.
  - `probe` computes one or more uni or multivariate summary statistics on both actual and simulated data.
  - `spect` estimates the power spectral density functions for the actual and simulated data.
- *Inference algorithms*
  - `abc`: approximate Bayesian computation
  - `bsmc2`: Liu-West algorithm for Bayesian SMC
  - `pmcmc`: a particle MCMC algorithm
  - `mif2`: iterated filtering (IF2)
  - `enkf`, eakf ensemble and ensemble adjusted Kalman filters 
  - `traj` objfun: trajectory matching
  - `spect` objfun: power spectrum matching
  - `probe` objfun: probe matching
  - `nlf` objfun: nonlinear forecasting

---